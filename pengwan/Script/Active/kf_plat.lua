--[[
file: kf_plat.lua
desc: 各平台钻等级奖励
autor: wk
]]--


--[[
	固定活动使用汇总
	2000000001-2000000099--开服排行榜1
	2000000101-2000000199---平台专属活动
	2000001001-2000001099--开服排行榜2
	2000001101-2000001199--春节活动
	2000001201-2000001299--51活动
	2000002001-2000002099--开服排行榜3
	2000005001-2000005099--开服充值活动
	2000005101-2000005199--脚本排行存储,1为累计,2为昨日
	2000005201-2000005209--开服累冲活动
	2000005211-2000005229--开服后每日充值+礼包活动

	2100001001-2100001099--和服排行榜
	2100001101-2100001199--新版合服活动
	2100000101-2100000199--合服补偿


]]--





local pairs,ipairs,type = pairs,ipairs,type
local os_date = os.date
local GetServerOpenTime = GetServerOpenTime
local GetServerTime = GetServerTime
local rint = rint
local look = look
local __G = _G

local time_proc_m = require('Script.active.time_proc')
local regist_event_dynamic = time_proc_m.regist_event_dynamic

-------------------------------------------------------------------------
--module:

module(...)

------------------------------------------------------------------------
--inner:
---360平台专属2000000101-2000000200
local kf_platconf_101 = {
	-- [2000000101] = {
		-- list = { title = '红钻等级领奖',vIcon = 1026,ver = 0,pic = 0 },
		-- cache = {
			-- tView = 0,tBegin = 0,tEnd = 10*360*24 * 3600 ,tAward = 0,
			-- AwardBuf = {
				-- [1] = {---年费
					-- con ={ [1003] = 1 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{636,5,1},{601,30,1},{603,30,1},{52,2,1},{605,30,1},},
					-- },
				-- },
				-- [2] = {---v1
					-- con ={ [1003] = 2 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{636,2,1},{634,2,1},{601,10,1},},
					-- },
				-- },
				-- [3] = {---v2
					-- con ={ [1003] = 3 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{636,5,1},{634,5,1},{601,20,1},},
					-- },
				-- },
				-- [4] = {---v3
					-- con ={ [1003] = 4 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{636,5,1},{710,2,1},{604,30,1},{601,30,1},},
					-- },
				-- },
				-- [5] = {---v4
					-- con ={ [1003] = 5 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{636,10,1},{710,5,1},{604,30,1},{601,40,1},{625,1,1},},
					-- },
				-- },
				-- [6] = {---v5
					-- con ={ [1003] = 6 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{634,10,1},{710,10,1},{604,50,1},{601,50,1},{663,1,1},},
					-- },
				-- },
				-- [7] = {---每日领奖v1
					-- con ={ [1004] = 1 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{601,5,1},{604,5,1},},
					-- },
				-- },
				-- [8] = {---每日领奖v2
					-- con ={ [1004] = 2 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{601,6,1},{604,6,1},},
					-- },
				-- },
				-- [9] = {---每日领奖v3
					-- con ={ [1004] = 3 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{601,7,1},{604,7,1},},
					-- },
				-- },
				-- [10] = {---每日领奖v4
					-- con ={ [1004] = 4 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{601,8,1},{604,8,1},},
					-- },
				-- },
				-- [11] = {---每日领奖v5
					-- con ={ [1004] = 5 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{601,10,1},{604,10,1},{636,1,1},},
					-- },
				-- },
			-- },
		-- },
	-- },
	-- [2000000103] = {
		-- list = { title = '安全卫士等级领奖',vIcon = 1027,ver = 0,pic = 0 },
		-- cache = {
			-- tView = 0,tBegin = 0,tEnd = 365*24*3600,tAward = 0,
			-- AwardBuf = {
				-- [1] = {---卫士等级5
					-- con ={ [1003] = 101 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{1475,1,1},{603,15,1},{605,10,1},{640,3,1},{634,10,1},},
					-- },
				-- },
				-- [2] = {---卫士等级10
					-- con ={ [1003] = 102 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{1476,1,1},{640,6,1},{639,1,1},{636,10,1},{603,20,1},},
					-- },
				-- },
				-- [3] = {---卫士等级15
					-- con ={ [1003] = 103 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{1477,1,1},{634,20,1},{640,10,1},{627,50,1},{778,10,1},{601,30,1},},
					-- },
				-- },
				-- [4] = {---卫士等级20
					-- con ={ [1003] = 104 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{1478,1,1},{762,20,1},{636,5,1},{627,100,1},{789,10,1},{603,50,1},{640,12,1},},
					-- },
				-- },
				-- [5] = {---卫士等级30
					-- con ={ [1003] = 105 },
					-- num = 1,					
					-- awd = {
						-- [3] = {{1479,1,1},{9910,1,1},{640,20,1},{603,100,1},{634,60,1},{639,3,1},{778,10,1},},
						-- -- giveGoods={
				             -- -- [3] = {
				                -- -- [1] = {{1281,1,1},{5337,1,1},{640,20,1},{601,100,1},{710,6,1},{663,1,1},{635,20,1},},	-- 将军府
				                -- -- [2] = {{1281,1,1},{5374,1,1},{640,20,1},{601,100,1},{710,6,1},{663,1,1},{635,20,1},},	-- 修仙
				                -- -- [3] = {{1281,1,1},{5411,1,1},{640,20,1},{601,100,1},{710,6,1},{663,1,1},{635,20,1},},	-- 九黎
			                -- -- },
							
						-- -- },
					-- },
				-- },
				
			-- },
		-- },
	-- },
}
---yy平台专属2000000201-2000000300
local kf_platconf_102 = {
	[2000000201] = {
		list = { title = 'yy会员',vIcon = 1028,ver = 0,pic = 0 },
		cache = {
			tView = 0,tBegin = 0,tEnd = 10*360*24 * 3600,tAward = 0,
			AwardBuf = {----1005条件:1-7月,11-17季度,21-27年费
				[1] = {---每日领奖v1
					con ={ [1004] = 1 },
					num = 1,					
					awd = {
						[3] = {{601,2,1},{604,2,1},},
					},
				},
				[2] = {---每日领奖v2
					con ={ [1004] = 2 },
					num = 1,					
					awd = {
						[3] = {{601,4,1},{604,3,1},},
					},
				},
				[3] = {---每日领奖v3
					con ={ [1004] = 3 },
					num = 1,					
					awd = {
						[3] = {{601,6,1},{604,4,1},},
					},
				},
				[4] = {---每日领奖v4
					con ={ [1004] = 4 },
					num = 1,					
					awd = {
						[3] = {{601,8,1},{604,5,1},},
					},
				},
				[5] = {---每日领奖v5
					con ={ [1004] = 5 },
					num = 1,					
					awd = {
						[3] = {{601,10,1},{604,6,1},},
					},
				},
				[6] = {---每日领奖v6
					con ={ [1004] = 6 },
					num = 1,					
					awd = {
						[3] = {{601,12,1},{604,7,1},},
					},
				},
				[7] = {---每日领奖v7
					con ={ [1004] = 7 },
					num = 1,					
					awd = {
						[3] = {{601,14,1},{604,8,1},},
					},
				},
				[8] = {---每日领奖v2
					con ={ [1004] = 11 },
					num = 1,					
					awd = {
						[3] = {{601,2,1},{604,2,1},{636,1,1},{603,5,1},{605,5,1},},
					},
				},
				[9] = {---每日领奖v3
					con ={ [1004] = 12 },
					num = 1,					
					awd = {
						[3] = {{601,4,1},{604,3,1},{636,1,1},{603,5,1},{605,5,1},},
					},
				},
				[10] = {---每日领奖v4
					con ={ [1004] = 13 },
					num = 1,					
					awd = {
						[3] = {{601,6,1},{604,4,1},{636,1,1},{603,5,1},{605,5,1},},
					},
				},
				[11] = {---每日领奖v5
					con ={ [1004] = 14 },
					num = 1,					
					awd = {
						[3] = {{601,8,1},{604,5,1},{636,1,1},{603,5,1},{605,5,1},},
					},
				},
				[12] = {---每日领奖v1
					con ={ [1004] = 15 },
					num = 1,					
					awd = {
						[3] = {{601,10,1},{604,6,1},{636,1,1},{603,5,1},{605,5,1},},
					},
				},
				[13] = {---每日领奖v2
					con ={ [1004] = 16 },
					num = 1,					
					awd = {
						[3] = {{601,12,1},{604,7,1},{636,1,1},{603,5,1},{605,5,1},},
					},
				},
				[14] = {---每日领奖v3
					con ={ [1004] = 17 },
					num = 1,					
					awd = {
						[3] = {{601,14,1},{604,8,1},{636,1,1},{603,5,1},{605,5,1},},
					},
				},
				[15] = {---每日领奖v4
					con ={ [1004] = 21 },
					num = 1,					
					awd = {
						[3] = {{601,2,1},{604,2,1},{710,1,1},{636,1,1},{603,5,1},{605,5,1},},
					},
				},
				[16] = {---每日领奖v5
					con ={ [1004] = 22 },
					num = 1,					
					awd = {
						[3] = {{601,4,1},{604,3,1},{710,1,1},{636,1,1},{603,5,1},{605,5,1},},
					},
				},
				[17] = {---每日领奖v5
					con ={ [1004] = 23 },
					num = 1,					
					awd = {
						[3] = {{601,6,1},{604,4,1},{710,1,1},{636,1,1},{603,5,1},{605,5,1},},
					},
				},
				[18] = {---每日领奖v5
					con ={ [1004] = 24 },
					num = 1,					
					awd = {
						[3] = {{601,8,1},{604,5,1},{710,1,1},{636,1,1},{603,5,1},{605,5,1},},
					},
				},
				[19] = {---每日领奖v5
					con ={ [1004] = 25 },
					num = 1,					
					awd = {
						[3] = {{601,10,1},{604,6,1},{710,1,1},{636,1,1},{603,5,1},{605,5,1},},
					},
				},
				[20] = {---每日领奖v5
					con ={ [1004] = 26 },
					num = 1,					
					awd = {
						[3] = {{601,12,1},{604,7,1},{710,1,1},{636,1,1},{603,5,1},{605,5,1},},
					},
				},
				[21] = {---每日领奖v5
					con ={ [1004] = 27 },
					num = 1,					
					awd = {
						[3] = {{601,14,1},{604,8,1},{710,1,1},{636,1,1},{603,5,1},{605,5,1},},
					},
				},
				
			},
		},
	},
}

-- 取自然天秒数
function GetNaturalDay1(t)
	local sec = rint(t/(24*3600)) * 24 * 3600 - 8*3600
	return sec
end

-- 平台插入运营活动
function _insert_plat_active()
	 look('平台插入运营活动')
	local openTime = GetServerOpenTime()
	-- local openTime = GetServerTime()-100----  先这样测试,后面改为开服时间
	-- look(openTime)

	local kf_plat_conf
	if openTime == 0 then return end
	local plat=__G.__plat
	-- local plat=102  ----测试设置平台用
	if plat==101 then 
		kf_plat_conf=kf_platconf_101
	elseif plat==102 then 
		kf_plat_conf=kf_platconf_102
	end
	if kf_plat_conf==nil then return end
	look(plat)
	local list = __G.AllActiveListConf.list
	local cache = __G.AllActiveListConf.cache
	if list == nil or cache == nil then return end
	for k, v in pairs(kf_plat_conf) do
		look(k)
		list[k] = v.list
		cache[k] = {}
		-- look('v.cache.tView:' .. v.cache.tView)
		-- look('openTime:' .. openTime)
		cache[k].tView = os_date('%Y-%m-%d %H:%M:%S', GetNaturalDay1(openTime+v.cache.tView))
		cache[k].tBegin = os_date('%Y-%m-%d %H:%M:%S', GetNaturalDay1(openTime+v.cache.tBegin))
		cache[k].tEnd = os_date('%Y-%m-%d %H:%M:%S', GetNaturalDay1(openTime+v.cache.tEnd))
		cache[k].tAward = os_date('%Y-%m-%d %H:%M:%S', GetNaturalDay1(openTime+v.cache.tAward))
		cache[k].AwardBuf = v.cache.AwardBuf
	end
end

------------------------------------------------------------------------
--interface:

insert_plat_active = _insert_plat_active